<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ChatApp</title>
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <div id="auth-overlay" class="auth-overlay">
        <div class="auth-card">
            <header class="auth-header">
                <h1>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi ChatApp</h1>
                <p>ƒêƒÉng nh·∫≠p ho·∫∑c t·∫°o t√†i kho·∫£n ƒë·ªÉ kh√°m ph√° c·ªông ƒë·ªìng c·ªßa b·∫°n.</p>
            </header>
            <div class="auth-tabs">
                <button id="tab-login" class="auth-tab active" type="button">ƒêƒÉng nh·∫≠p</button>
                <button id="tab-register" class="auth-tab" type="button">ƒêƒÉng k√Ω</button>
            </div>
            <form id="login-form" class="auth-form" autocomplete="off">
                <label class="field">
                    <span>T√™n ƒëƒÉng nh·∫≠p</span>
                    <input id="login-username" name="username" placeholder="V√≠ d·ª•: sinhvien123" required />
                </label>
                <label class="field">
                    <span>M·∫≠t kh·∫©u</span>
                    <input id="login-password" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
                </label>
                <button type="submit" class="auth-submit">ƒêƒÉng nh·∫≠p</button>
            </form>

            <form id="register-form" class="auth-form hidden" autocomplete="off">
                <label class="field">
                    <span>T√™n ƒëƒÉng nh·∫≠p</span>
                    <input id="register-username" name="username" placeholder="Ch·ªçn t√™n th·∫≠t ng·∫ßu ‚ú®" required />
                </label>
                <label class="field">
                    <span>M·∫≠t kh·∫©u</span>
                    <input id="register-password" name="password" type="password" minlength="6" placeholder="√çt nh·∫•t 6 k√Ω t·ª±" required />
                </label>
                <button type="submit" class="auth-submit accent">T·∫°o t√†i kho·∫£n</button>
            </form>
        </div>
    </div>

    <div id="app-shell" class="app-shell hidden">
        <nav class="server-rail">
            <div class="server-rail__header">
                <span class="rail-logo">üí¨</span>
            </div>
            <ul id="server-list" class="server-rail__list">
                <!-- populated by JS -->
            </ul>
            <button id="open-create-server" class="server-rail__create" type="button" title="T·∫°o m√°y ch·ªß"><span>+</span></button>
        </nav>

        <aside class="channel-pane">
            <header class="channel-pane__header">
                <div>
                    <h2 id="active-server-name">Global Community</h2>
                    <span id="active-server-desc">K·∫øt n·ªëi v·ªõi m·ªçi ng∆∞·ªùi</span>
                </div>
                <button id="open-server-settings" class="icon-button" type="button" title="C√†i ƒë·∫∑t m√°y ch·ªß">‚öô</button>
            </header>

            <section class="channel-section">
                <div class="channel-section__title">
                    <span>K√äNH VƒÇN B·∫¢N</span>
                    <button id="create-channel-btn" class="icon-button small" type="button" title="T·∫°o k√™nh">+</button>
                </div>
                <ul id="channel-list" class="channel-list"></ul>
            </section>

            <section class="channel-section">
                <div class="channel-section__title">
                    <span>TIN NH·∫ÆN RI√äNG</span>
                    <div class="channel-section__actions">
                        <button id="open-friend-center" class="icon-button small" type="button" title="Qu·∫£n l√Ω b·∫°n b√®">ü§ù</button>
                        <button id="open-dm-btn" class="icon-button small" type="button" title="T·∫°o DM m·ªõi">+</button>
                    </div>
                </div>
                <div class="dm-search">
                    <input id="dm-search-input" placeholder="T√¨m b·∫°n b√®..." />
                </div>
                <ul id="dm-list" class="dm-list"></ul>
            </section>

            <footer class="channel-pane__footer">
                <div class="user-card">
                    <div class="avatar" id="session-avatar"></div>
                    <div class="user-card__info">
                        <span id="session-username" class="user-card__name"></span>
                        <span class="user-card__status">Online</span>
                    </div>
                </div>
                <button id="logout-btn" class="icon-button" type="button" title="ƒêƒÉng xu·∫•t">‚éã</button>
            </footer>
        </aside>

        <main class="chat-main">
            <header class="chat-toolbar">
                <div class="chat-toolbar__info">
                    <span class="chat-toolbar__hash">#</span>
                    <div>
                        <h1 id="active-channel-name">general</h1>
                        <p id="active-channel-topic">N∆°i tr√≤ chuy·ªán chung c·ªßa t·∫•t c·∫£ m·ªçi ng∆∞·ªùi</p>
                    </div>
                </div>
                <div class="chat-toolbar__actions">
                    <input id="global-search" placeholder="T√¨m ki·∫øm tin nh·∫Øn" />
                    <button class="icon-button" type="button" title="M·ªùi b·∫°n b√® v√†o k√™nh" id="invite-friend-btn">‚ûï</button>
                    <button class="icon-button" type="button" title="B·∫≠t danh s√°ch th√†nh vi√™n" id="toggle-memberlist">üë•</button>
                </div>
            </header>

            <div id="chat-content" class="chat-content">
                <div id="message-list" class="message-list"></div>
                <div id="typing-indicator" class="typing-indicator hidden"></div>
            </div>

            <footer class="composer-bar">
                <form id="composer" autocomplete="off">
                    <button id="emoji-btn" class="icon-button" type="button" title="Emoji">üòä</button>
                    <input id="message-input" placeholder="Nh·∫≠p tin nh·∫Øn. S·ª≠ d·ª•ng Ctrl + Enter ƒë·ªÉ g·ª≠i nhanh." />
                    <div class="composer-actions">
                        <label for="file-input" class="icon-button" title="ƒê√≠nh k√®m t·ªáp">üìé</label>
                        <input id="file-input" type="file" accept="image/*,video/*,audio/*,.gif,.png,.jpg,.jpeg,.mp4,.mp3,.wav" hidden />
                        <button id="send-btn" class="primary-btn" type="submit">G·ª≠i</button>
                    </div>
                </form>
            </footer>
        </main>

        <aside id="member-pane" class="member-pane">
            <section class="member-section">
                <h3>Th√†nh vi√™n m√°y ch·ªß ‚Äî <span id="guild-member-count">0</span></h3>
                <ul id="guild-members" class="member-list"></ul>
            </section>

            <section class="member-section">
                <h3>Online ‚Äî <span id="online-count">0</span></h3>
                <ul id="online-users" class="member-list"></ul>
            </section>

            <section class="member-section">
                <h3>T·∫•t c·∫£ t√†i kho·∫£n</h3>
                <input id="user-search" class="member-search" placeholder="T√¨m ki·∫øm username..." />
                <ul id="directory-users" class="member-list directory"></ul>
            </section>

            <section class="event-section">
                <h3>Ngu·ªìn c·∫•p ho·∫°t ƒë·ªông</h3>
                <ul id="event-log" class="event-log"></ul>
            </section>

            <section class="event-section">
                <h3>T·ªáp ƒë√£ t·∫£i l√™n</h3>
                <ul id="uploaded-files" class="uploaded-files"></ul>
            </section>
        </aside>
    </div>

    <!-- Create server modal -->
    <div id="create-server-modal" class="modal hidden">
        <div class="modal__dialog">
            <header class="modal__header">
                <h2>T·∫°o m√°y ch·ªß m·ªõi</h2>
                <button class="icon-button" type="button" data-close-modal>‚úï</button>
            </header>
            <form id="create-server-form" class="modal__body">
                <label class="field">
                    <span>T√™n m√°y ch·ªß</span>
                    <input id="new-server-name" placeholder="B·∫°n b√®, l·ªõp h·ªçc, c·ªông ƒë·ªìng..." required />
                </label>
                <label class="field">
                    <span>M√¥ t·∫£</span>
                    <input id="new-server-desc" placeholder="Gi·ªõi thi·ªáu ng·∫Øn g·ªçn" />
                </label>
                <button class="primary-btn full" type="submit">T·∫°o m√°y ch·ªß</button>
            </form>
        </div>
    </div>

    <!-- Create channel modal -->
    <div id="create-channel-modal" class="modal hidden">
        <div class="modal__dialog">
            <header class="modal__header">
                <h2>T·∫°o k√™nh vƒÉn b·∫£n</h2>
                <button class="icon-button" type="button" data-close-modal>‚úï</button>
            </header>
            <form id="create-channel-form" class="modal__body">
                <label class="field">
                    <span>T√™n k√™nh</span>
                    <input id="new-channel-name" placeholder="v√≠ d·ª•: bai-tap, hang-out..." required />
                </label>
                <label class="checkbox-field">
                    <input id="channel-private" type="checkbox" disabled />
                    <span>K√™nh ri√™ng t∆∞ (ƒëang ph√°t tri·ªÉn)</span>
                </label>
                <button class="primary-btn full" type="submit">T·∫°o k√™nh</button>
            </form>
        </div>
    </div>

    <!-- Create DM modal -->
    <div id="create-dm-modal" class="modal hidden">
        <div class="modal__dialog">
            <header class="modal__header">
                <h2>Trung t√¢m b·∫°n b√®</h2>
                <button class="icon-button" type="button" data-close-modal>‚úï</button>
            </header>
            <div class="modal__body dm-modal">
                <section class="modal-section">
                    <h3>Danh s√°ch b·∫°n b√®</h3>
                    <ul id="friend-list" class="modal-list"></ul>
                </section>
                <section class="modal-section">
                    <div class="modal-section-header">
                        <h3>Y√™u c·∫ßu k·∫øt b·∫°n</h3>
                        <button type="button" class="section-close-btn" id="close-friend-requests-section" title="ƒê√≥ng">‚úï</button>
                    </div>
                    <div class="modal-subsection">
                        <h4>ƒêang ch·ªù</h4>
                        <ul id="incoming-requests" class="modal-list compact"></ul>
                    </div>
                    <div class="modal-subsection">
                        <h4>ƒê√£ g·ª≠i</h4>
                        <ul id="outgoing-requests" class="modal-list compact"></ul>
                    </div>
                </section>
                <section class="modal-section">
                    <h3>Th√™m b·∫°n m·ªõi</h3>
                    <form id="add-friend-form" class="add-friend-form">
                        <input id="add-friend-username" placeholder="Nh·∫≠p username..." />
                        <button type="submit" class="primary-btn small">G·ª≠i l·ªùi m·ªùi</button>
                    </form>
                    <h4>T√¨m ki·∫øm ng∆∞·ªùi d√πng</h4>
                    <input id="search-user-input" placeholder="T√¨m ki·∫øm username..." />
                    <ul id="search-user-list" class="modal-list compact"></ul>
                    <h4>Nh·∫Øn tin nhanh</h4>
                    <input id="dm-filter" placeholder="L·ªçc b·∫°n b√®..." />
                    <ul id="dm-candidate-list" class="modal-list"></ul>
                </section>
            </div>
        </div>
    </div>

    <!-- Invite friend modal -->
    <div id="invite-friend-modal" class="modal hidden">
        <div class="modal__dialog">
            <header class="modal__header">
                <h2>M·ªùi b·∫°n b√® v√†o m√°y ch·ªß</h2>
                <button class="icon-button" type="button" data-close-modal>‚úï</button>
            </header>
            <div class="modal__body">
                <p style="color: var(--text-muted); margin-bottom: 16px;">Ch·ªçn b·∫°n b√® ƒë·ªÉ m·ªùi v√†o m√°y ch·ªß hi·ªán t·∫°i:</p>
                <ul id="invite-friend-list" class="modal-list"></ul>
            </div>
        </div>
    </div>

    <div id="toast" class="toast hidden"></div>

    <!-- Image viewer modal -->
    <div id="image-viewer-modal" class="modal hidden">
        <div class="modal__dialog" style="max-width: 95vw; max-height: 95vh; background: transparent; border: none; padding: 0;">
            <button class="icon-button" type="button" data-close-modal style="position: absolute; top: 10px; right: 10px; z-index: 10001; background: rgba(0,0,0,0.7); color: white; border: 1px solid rgba(255,255,255,0.3);">‚úï</button>
            <img id="image-viewer-img" src="" alt="·∫¢nh" style="max-width: 250%; max-height: 95vh; border-radius: 8px; cursor: pointer; display: block; margin: 0 auto; transform: scale(2.5); transform-origin: center center;" />
        </div>
    </div>

    <script src="./app.js"></script>
</body>
</html>

